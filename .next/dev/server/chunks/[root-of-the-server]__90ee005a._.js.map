{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/D/next/engage333/app/api/qr/route.ts"],"sourcesContent":["// app/api/products/route.ts\nimport { NextRequest, NextResponse } from \"next/server\";\nimport QRCodeStyling from \"qr-code-styling/lib/qr-code-styling.common.js\";\nimport { JSDOM } from \"jsdom\";\nimport { createCanvas } from \"canvas\";\nimport { v4 as uuidv4 } from \"uuid\";\n\n// ──────────────────────────────────────────────────────────────\n// Server-side QR generation configuration\n// You can expand this later with more styling options coming from the request\n// ──────────────────────────────────────────────────────────────\n\nconst getQrOptions = (data: string) => ({\n  width: 400,\n  height: 400,\n  data,\n  margin: 5,\n  type: \"png\" as const,\n  qrOptions: { errorCorrectionLevel: \"H\" },\n  dotsOptions: {\n    type: \"rounded\",\n    color: \"#000000\",\n  },\n  backgroundOptions: { color: \"#ffffff\" },\n  // cornersSquareOptions: { type: \"extra-rounded\", color: \"#000000\" },\n  // cornersDotOptions:  { type: \"dot\",         color: \"#000000\" },\n  // image: \"https://your-logo-url.com/logo.png\",  // if you want to embed logo\n  // imageOptions: { hideBackgroundDots: true, imageSize: 0.4, margin: 8 },\n});\n\n// ──────────────────────────────────────────────────────────────\n// POST /api/products\n// Creates product → generates QR code → returns QR image as base64\n// No AWS / S3 upload – image is returned directly in response\n// ──────────────────────────────────────────────────────────────\n\nexport async function POST(req: NextRequest) {\n  try {\n    const body = await req.json();\n\n    const {\n      name,\n      price,\n      description,\n      // ... other product fields you need\n      baseUrl = \"https://yourdomain.com/product\", // ← change to your real domain / path\n    } = body;\n\n    if (!name) {\n      return NextResponse.json({ error: \"Product name is required\" }, { status: 400 });\n    }\n\n    // 1. Generate unique product identifier\n    // (in real app you would save to database first and use real ID)\n    const productId = uuidv4();\n\n    // 2. Create the URL that the QR code should point to\n    const qrTargetUrl = `${baseUrl}/${productId}`;\n\n    // 3. Generate QR code on the server\n    const dom = new JSDOM(\"<!DOCTYPE html><div id='qr-container'></div>\");\n    const document = dom.window.document;\n\n    const qr = new QRCodeStyling({\n      ...getQrOptions(qrTargetUrl),\n      jsdom: JSDOM,\n      nodeCanvas: createCanvas,\n    });\n\n    // Get raw PNG buffer\n    const qrBuffer = await qr.getRawData(\"png\");\n\n    // 4. Convert buffer → base64 string (safe to send in JSON)\n    const qrBase64 = qrBuffer.toString(\"base64\");\n\n    // 5. In real application → save product to database here\n    // Example (commented):\n    //\n    // await prisma.product.create({\n    //   data: {\n    //     id: productId,\n    //     name,\n    //     price: price ? Number(price) : null,\n    //     description,\n    //     qrCodeBase64: qrBase64,           // or save to public/uploads/ folder\n    //     qrTargetUrl,\n    //   }\n    // });\n\n    // 6. Return response with everything frontend might need\n    return NextResponse.json({\n      success: true,\n      productId,\n      qrTargetUrl,\n      qrImageBase64: `data:image/png;base64,${qrBase64}`,\n      // You can also return other product data if needed\n      name,\n      price,\n      description,\n    });\n\n  } catch (err: any) {\n    console.error(\"Product + QR creation failed:\", err);\n    return NextResponse.json(\n      {\n        error: \"Failed to create product and generate QR code\",\n        details: err.message,\n      },\n      { status: 500 }\n    );\n  }\n}"],"names":[],"mappings":"AAAA,4BAA4B;;;;;AAC5B;AACA;AACA;AACA;;;;;;;;;;;AAGA,iEAAiE;AACjE,0CAA0C;AAC1C,8EAA8E;AAC9E,iEAAiE;AAEjE,MAAM,eAAe,CAAC,OAAiB,CAAC;QACtC,OAAO;QACP,QAAQ;QACR;QACA,QAAQ;QACR,MAAM;QACN,WAAW;YAAE,sBAAsB;QAAI;QACvC,aAAa;YACX,MAAM;YACN,OAAO;QACT;QACA,mBAAmB;YAAE,OAAO;QAAU;IAKxC,CAAC;AAQM,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI;QAE3B,MAAM,EACJ,IAAI,EACJ,KAAK,EACL,WAAW,EACX,oCAAoC;QACpC,UAAU,gCAAgC,EAC3C,GAAG;QAEJ,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA2B,GAAG;gBAAE,QAAQ;YAAI;QAChF;QAEA,wCAAwC;QACxC,iEAAiE;QACjE,MAAM,YAAY;QAElB,qDAAqD;QACrD,MAAM,cAAc,GAAG,QAAQ,CAAC,EAAE,WAAW;QAE7C,oCAAoC;QACpC,MAAM,MAAM,IAAI,4GAAK,CAAC;QACtB,MAAM,WAAW,IAAI,MAAM,CAAC,QAAQ;QAEpC,MAAM,KAAK,IAAI,4LAAa,CAAC;YAC3B,GAAG,aAAa,YAAY;YAC5B,OAAO,4GAAK;YACZ,YAAY,qHAAY;QAC1B;QAEA,qBAAqB;QACrB,MAAM,WAAW,MAAM,GAAG,UAAU,CAAC;QAErC,2DAA2D;QAC3D,MAAM,WAAW,SAAS,QAAQ,CAAC;QAEnC,yDAAyD;QACzD,uBAAuB;QACvB,EAAE;QACF,gCAAgC;QAChC,YAAY;QACZ,qBAAqB;QACrB,YAAY;QACZ,2CAA2C;QAC3C,mBAAmB;QACnB,6EAA6E;QAC7E,mBAAmB;QACnB,MAAM;QACN,MAAM;QAEN,yDAAyD;QACzD,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT;YACA;YACA,eAAe,CAAC,sBAAsB,EAAE,UAAU;YAClD,mDAAmD;YACnD;YACA;YACA;QACF;IAEF,EAAE,OAAO,KAAU;QACjB,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,OAAO;YACP,SAAS,IAAI,OAAO;QACtB,GACA;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}